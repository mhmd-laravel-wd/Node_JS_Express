/**
 * ===============================
 * استدعاء موديل المستخدم
 * ===============================
 * لاستعماله في حفظ البيانات في قاعدة البيانات
 */
const User = require("../models/userSchema");

/**
 * ===============================
 * دالة حفظ المستخدم الجديد
 * ===============================
 * تأخذ البيانات من الفورم وترسلها للـ MongoDB
 */
exports.storeUser = async (req, res, appUrl) => {
  try {
    /**
     * إنشاء كائن مستخدم جديد باستخدام البيانات القادمة من الفورم
     * req.body يحتوي على جميع الحقول المرسلة من الفورم
     */
    const user = new User(req.body);

    /**
     * حفظ المستخدم في قاعدة البيانات
     * await لضمان اكتمال العملية قبل متابعة التنفيذ
     */
    await user.save();

    /**
     * بعد الحفظ، إعادة التوجيه إلى الصفحة الرئيسية
     */
    // إرسال appUrl مباشرة للقالب بعد الحفظ
    const users = await User.find();
    res.render("form.ejs", { users, appUrl });
  } catch (error) {
    /**
     * طباعة أي خطأ يحدث أثناء الحفظ في الكونسول
     */
    console.error(error);
  }
};
